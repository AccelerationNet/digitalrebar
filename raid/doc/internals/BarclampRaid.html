<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: BarclampRaid
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!BarclampRaid.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (B)</a> &raquo;
    
    
    <span class="title">BarclampRaid</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: BarclampRaid
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb<span class="defines">,<br />
  crowbar_engine/barclamp_raid/app/models/barclamp_raid/lsi_ircu.rb,<br /> crowbar_engine/barclamp_raid/app/models/barclamp_raid/lsi_megacli.rb,<br /> crowbar_engine/barclamp_raid/app/helpers/barclamp_raid/application_helper.rb,<br /> crowbar_engine/barclamp_raid/app/controllers/barclamp_raid/application_controller.rb,<br /> crowbar_engine/barclamp_raid/lib/barclamp_raid.rb,<br /> crowbar_engine/barclamp_raid/lib/barclamp_raid/engine.rb,<br /> crowbar_engine/barclamp_raid/lib/barclamp_raid/version.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Copyright © 2014, Victor Lowther</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not
use this file except in compliance with the License. You may obtain a copy
of the License at</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_http'>http</span><span class='symbol'>:/</span><span class='op'>/</span><span class='id identifier rubyid_www'>www</span><span class='period'>.</span><span class='id identifier rubyid_apache'>apache</span><span class='period'>.</span><span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_licenses'>licenses</span><span class='op'>/</span><span class='const'>LICENSE</span><span class='op'>-</span><span class='float'>2.0</span></code></pre>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="BarclampRaid/ApplicationHelper.html" title="BarclampRaid::ApplicationHelper (module)">ApplicationHelper</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="BarclampRaid/ApplicationController.html" title="BarclampRaid::ApplicationController (class)">ApplicationController</a></span>, <span class='object_link'><a href="BarclampRaid/Controller.html" title="BarclampRaid::Controller (class)">Controller</a></span>, <span class='object_link'><a href="BarclampRaid/Discover.html" title="BarclampRaid::Discover (class)">Discover</a></span>, <span class='object_link'><a href="BarclampRaid/Driver.html" title="BarclampRaid::Driver (class)">Driver</a></span>, <span class='object_link'><a href="BarclampRaid/Engine.html" title="BarclampRaid::Engine (class)">Engine</a></span>, <span class='object_link'><a href="BarclampRaid/HashBucket.html" title="BarclampRaid::HashBucket (class)">HashBucket</a></span>, <span class='object_link'><a href="BarclampRaid/Jig.html" title="BarclampRaid::Jig (class)">Jig</a></span>, <span class='object_link'><a href="BarclampRaid/Lsi_Megacli.html" title="BarclampRaid::Lsi_Megacli (class)">Lsi_Megacli</a></span>, <span class='object_link'><a href="BarclampRaid/Lsi_Sasircu.html" title="BarclampRaid::Lsi_Sasircu (class)">Lsi_Sasircu</a></span>, <span class='object_link'><a href="BarclampRaid/RaidDisk.html" title="BarclampRaid::RaidDisk (class)">RaidDisk</a></span>, <span class='object_link'><a href="BarclampRaid/RaidHammer.html" title="BarclampRaid::RaidHammer (class)">RaidHammer</a></span>, <span class='object_link'><a href="BarclampRaid/ToolsInstall.html" title="BarclampRaid::ToolsInstall (class)">ToolsInstall</a></span>, <span class='object_link'><a href="BarclampRaid/Volume.html" title="BarclampRaid::Volume (class)">Volume</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="KILO-constant" class="">KILO =
          
        </dt>
        <dd><pre class="code"><span class='int'>1024</span></pre></dd>
      
        <dt id="MEGA-constant" class="">MEGA =
          
        </dt>
        <dd><pre class="code"><span class='const'>KILO</span> <span class='op'>*</span> <span class='int'>1024</span></pre></dd>
      
        <dt id="GIGA-constant" class="">GIGA =
          
        </dt>
        <dd><pre class="code"><span class='const'>MEGA</span> <span class='op'>*</span> <span class='int'>1024</span></pre></dd>
      
        <dt id="TERA-constant" class="">TERA =
          
        </dt>
        <dd><pre class="code"><span class='const'>GIGA</span> <span class='op'>*</span> <span class='int'>1024</span></pre></dd>
      
        <dt id="LEVELS-constant" class="">LEVELS =
          <div class="docstring">
  <div class="discussion">
    
<p>The list of raid levels the raid handing methods are expected to support.
Individual controllers may or may not support all of these.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>jbod</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span>  <span class='int'>1</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>simple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>0</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid0</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1000</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>simple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>0</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid1</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>simple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid5</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1000</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>simple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid6</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>4</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1000</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>simple</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid00</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spanned</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>span_type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid0</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid10</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spanned</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>span_type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid1</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid50</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spanned</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>span_type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid5</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid60</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spanned</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>span_type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid6</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.1</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calc_raid_overhead-class_method" title="calc_raid_overhead (class method)">+ (Array(Integer,Integer,Integer)) <strong>calc_raid_overhead</strong>(type, spans = 1) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate the min disks, max disks, and disks used for overhead for a given
raid type and raid spans.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calc_spans-class_method" title="calc_spans (class method)">+ (Array(Integer,Integer)) <strong>calc_spans</strong>(raid_level, disks) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate how many spans are needed for the RAID type and number of disks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#raid_per_disk_size-class_method" title="raid_per_disk_size (class method)">+ (Integer) <strong>raid_per_disk_size</strong>(volume_size, raid_level, disks, spans = 1, stripe_size = 65536) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a target volume size, a raid type, the number of disks in the raid,
and the stripe size, figure out how much space on each physical disk the
target volume needs to occupy.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#size_to_bytes-class_method" title="size_to_bytes (class method)">+ (Integer) <strong>size_to_bytes</strong>(s) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A handy utility method for converting sizes in string form to sizes in
bytes.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="calc_raid_overhead-class_method">
  
    + (<tt>Array(Integer,Integer,Integer)</tt>) <strong>calc_raid_overhead</strong>(type, spans = 1) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate the min disks, max disks, and disks used for overhead for a given
raid type and raid spans.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of RAID to calculate for</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>spans</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The number of spans this raid array contains</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array(Integer,Integer,Integer)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array of the minimum number of disks in the array, the maximum number of
disks in the array, and number of disks used as overhead.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 82</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calc_raid_overhead'>calc_raid_overhead</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span><span class='id identifier rubyid_spans'>spans</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot calculate overhead for RAID type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type'>type</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>LEVELS</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>simple</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot calculate overhead for simple RAID type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type'>type</span><span class='embexpr_end'>}</span><span class='tstring_content'> with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spans'>spans</span><span class='embexpr_end'>}</span><span class='tstring_content'> spans</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_spans'>spans</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='lbracket'>[</span><span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
     <span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>spanned</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Spanned RAID volumes cannot contain a single span</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_spans'>spans</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>span_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='lbracket'>[</span><span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min_disks</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_spans'>spans</span><span class='comma'>,</span>
     <span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max_disks</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_spans'>spans</span><span class='comma'>,</span>
     <span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>overhead</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_spans'>spans</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown key type for </span><span class='embexpr_beg'>#{</span><span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> type </span><span class='embexpr_beg'>#{</span><span class='const'>LEVELS</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calc_spans-class_method">
  
    + (<tt>Array(Integer,Integer)</tt>) <strong>calc_spans</strong>(raid_level, disks) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate how many spans are needed for the RAID type and number of disks.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>raid_level</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The raid level to calculate for.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array(Integer,Integer)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array containing the number of disks that will be used in the array, and
the total number of spans.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 121</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calc_spans'>calc_spans</span><span class='lparen'>(</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='comma'>,</span><span class='id identifier rubyid_disks'>disks</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_raid_level'>raid_level</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>jbod</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid5</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid6</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='id identifier rubyid_disks'>disks</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid00</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid50</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid60</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_disks'>disks</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid10</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='lbracket'>[</span><span class='lparen'>(</span><span class='id identifier rubyid_disks'>disks</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_disks'>disks</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot calculate disk spans for RAID type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type'>type</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="raid_per_disk_size-class_method">
  
    + (<tt>Integer</tt>) <strong>raid_per_disk_size</strong>(volume_size, raid_level, disks, spans = 1, stripe_size = 65536) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a target volume size, a raid type, the number of disks in the raid,
and the stripe size, figure out how much space on each physical disk the
target volume needs to occupy.  This function deliberately overestimates
the amount of space taken.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>volume_size</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The size of the volume in bytes.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>raid_level</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of RAID volume this is,</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>disks</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The total number of disks in the RAID.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>spans</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The number of spans in the RAID array.  Defaults to 1.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>stripe_size</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>65536</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The stripe size if individual stripes in this array. Defaults to 64KB</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>: The number of bytes the RAID volume will occupy on each physical disk.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 143</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raid_per_disk_size'>raid_per_disk_size</span><span class='lparen'>(</span><span class='id identifier rubyid_volume_size'>volume_size</span><span class='comma'>,</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='comma'>,</span><span class='id identifier rubyid_disks'>disks</span><span class='comma'>,</span><span class='id identifier rubyid_spans'>spans</span><span class='op'>=</span><span class='int'>1</span><span class='comma'>,</span><span class='id identifier rubyid_stripe_size'>stripe_size</span><span class='op'>=</span><span class='int'>65536</span><span class='rparen'>)</span>
  <span class='comment'># Overestimate the number of stripes per disk
</span>  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_overhead'>overhead</span> <span class='op'>=</span> <span class='const'>BarclampRaid</span><span class='period'>.</span><span class='id identifier rubyid_calc_raid_overhead'>calc_raid_overhead</span><span class='lparen'>(</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='comma'>,</span><span class='id identifier rubyid_spans'>spans</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_stripes_per_disk'>stripes_per_disk</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_volume_size'>volume_size</span> <span class='op'>/</span> <span class='lparen'>(</span><span class='id identifier rubyid_stripe_size'>stripe_size</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_disks'>disks</span> <span class='op'>-</span> <span class='id identifier rubyid_overhead'>overhead</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>
  <span class='id identifier rubyid_stripes_per_disk'>stripes_per_disk</span> <span class='op'>*</span> <span class='id identifier rubyid_stripe_size'>stripe_size</span> <span class='op'>*</span> <span class='id identifier rubyid_disks'>disks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="size_to_bytes-class_method">
  
    + (<tt>Integer</tt>) <strong>size_to_bytes</strong>(s) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A handy utility method for converting sizes in string form to sizes in
bytes.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Either the number of bytes, or a string in the format of “100 GB”</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The number of bytes.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 105</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_size_to_bytes'>size_to_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([0-9.]+)$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([0-9]+)\s*[Kk][Bb]$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>*</span> <span class='const'>KILO</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([0-9.]+)\s*[Mm][Bb]$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>*</span> <span class='const'>MEGA</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([0-9.]+)\s*[Gg][Bb]$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>*</span> <span class='const'>GIGA</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([0-9.]+)\s*[Tt][Bb]$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>*</span> <span class='const'>TERA</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_ceil'>ceil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Nov  4 04:15:57 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.2).
</div>

  </body>
</html>