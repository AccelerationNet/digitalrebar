<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: BarclampRaid::Controller
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!BarclampRaid/Controller.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../BarclampRaid.html" title="BarclampRaid (module)">BarclampRaid</a></span></span>
     &raquo; 
    <span class="title">Controller</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: BarclampRaid::Controller
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="HashBucket.html" title="BarclampRaid::HashBucket (class)">HashBucket</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveSupport::HashWithIndifferentAccess</li>
          
            <li class="next"><span class='object_link'><a href="HashBucket.html" title="BarclampRaid::HashBucket (class)">HashBucket</a></span></li>
          
            <li class="next">BarclampRaid::Controller</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>BarclampRaid::Controller holds everything we need to manipulate a RAID
controller.  It is mostly just a collection of peoperties exposed by the
underlying <span class='object_link'><a href="Driver.html" title="BarclampRaid::Driver (class)">Driver</a></span> that owns it.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="required_keys-classvariable" class="">@@required_keys =
          <div class="docstring">
  <div class="discussion">
    
<p>When a Controller is created, these keys must be present in the hash passed
to Controller.new.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>                   <span class='comment'># string to identify the controller.
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>driver</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>               <span class='comment'># a reference to the driver class
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>driver_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>          <span class='comment'># the name of the driver used to manage this controller.
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bus</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>                  <span class='comment'># bus number (integer)
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>device</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>               <span class='comment'># device bus number (integer)
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>function</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>             <span class='comment'># function bus number (integer)
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>firmware_version</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>     <span class='comment'># version of the firmware on the drive.
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>device_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>            <span class='comment'># device id as reported by card
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vendor_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>            <span class='comment'># vendor id as reported by card
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sub_device_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>        <span class='comment'># sub device id as reported by card
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sub_vendor_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>        <span class='comment'># sub vendor id as reported by card
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>product_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>         <span class='comment'># name of product (LSI2008 will be lame)
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid_capable</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>         <span class='comment'># boolean if raid is allowed or not
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>supported_raid_levels</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># list of symbols of supported RAID levels
</span><span class='rbracket'>]</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#driver-instance_method" title="#driver (instance method)">- (Object) <strong>driver</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the driver that manages this controller.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_config-instance_method" title="#clear_config (instance method)">- (Object) <strong>clear_config</strong>(config_type = :all) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear everything from the controller.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_vd-instance_method" title="#create_vd (instance method)">- (BarclampRaid::Volume) <strong>create_vd</strong>(volume) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a volume.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_vd-instance_method" title="#delete_vd (instance method)">- (Object) <strong>delete_vd</strong>(volume) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Delete a virtual disk.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_candidates-instance_method" title="#find_candidates (instance method)">- (Array&lt;BarclampRaid::RaidDisk&gt;) <strong>find_candidates</strong>(volume) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a volume specification hash, find disks on the controller that are
good candidates for including in the to-be-created volume.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Controller) <strong>initialize</strong>(h = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new Controller.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">- (Object) <strong>inspect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Utility method to make backtraces and debugging easier by killing
irrelavent detail.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">- (Object) <strong>name</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Simple unique name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unused_disks-instance_method" title="#unused_disks (instance method)">- (Object) <strong>unused_disks</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get disks that are not members of a volume.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#used_disks-instance_method" title="#used_disks (instance method)">- (Object) <strong>used_disks</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the disks that are members of a volume.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="HashBucket.html" title="BarclampRaid::HashBucket (class)">HashBucket</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="HashBucket.html#method_missing-instance_method" title="BarclampRaid::HashBucket#method_missing (method)">#method_missing</a></span></p>

  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="BarclampRaid::Controller (class)">Controller</a></span></tt>) <strong>initialize</strong>(h = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new Controller.  As a side effect, it populates volume and
physical disk information.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>h</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>A hash that contains at least the keys in @@required_keys</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202
203
204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 200</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_missing_keys'>missing_keys</span> <span class='op'>=</span> <span class='cvar'>@@required_keys</span> <span class='op'>-</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_missing_keys'>missing_keys</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BarclampRaid::Controller initialized with a hash missing required keys </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_missing_keys'>missing_keys</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@driver</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>driver</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@driver</span><span class='period'>.</span><span class='id identifier rubyid_refresh_controller'>refresh_controller</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice super">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
      in the class <span class='object_link'><a href="HashBucket.html#method_missing-instance_method" title="BarclampRaid::HashBucket#method_missing (method)">BarclampRaid::HashBucket</a></span>
    
  </p>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="driver-instance_method">
  
    - (<tt>Object</tt>) <strong>driver</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the driver that manages this controller.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 166</span>

<span class='kw'>def</span> <span class='id identifier rubyid_driver'>driver</span>
  <span class='ivar'>@driver</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear_config-instance_method">
  
    - (<tt>Object</tt>) <strong>clear_config</strong>(config_type = :all) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear everything from the controller. This also just hands off the request
to the appropriate driver.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>config_type</span>
      
      
        <span class='type'>(<tt>:foreign</tt>, <tt>:all</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>:all</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>What kind of configuration to clear from the system.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 335</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_config'>clear_config</span><span class='lparen'>(</span><span class='id identifier rubyid_config_type'>config_type</span> <span class='op'>=</span> <span class='symbol'>:all</span><span class='rparen'>)</span>
  <span class='ivar'>@driver</span><span class='period'>.</span><span class='id identifier rubyid_clear_controller_config'>clear_controller_config</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span><span class='id identifier rubyid_config_type'>config_type</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_vd-instance_method">
  
    - (<tt><span class='object_link'><a href="Volume.html" title="BarclampRaid::Volume (class)">BarclampRaid::Volume</a></span></tt>) <strong>create_vd</strong>(volume) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a volume.  This is a helper that hands the request off to the
appropriate driver.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>volume</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash of the same type that <span class='object_link'><a href="Driver.html#create_vd-instance_method" title="BarclampRaid::Driver#create_vd (method)">Driver#create_vd</a></span> takes.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Volume.html" title="BarclampRaid::Volume (class)">BarclampRaid::Volume</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The created volume.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


328
329
330</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 328</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_vd'>create_vd</span><span class='lparen'>(</span><span class='id identifier rubyid_volume'>volume</span><span class='rparen'>)</span>
  <span class='ivar'>@driver</span><span class='period'>.</span><span class='id identifier rubyid_create_vd'>create_vd</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span><span class='id identifier rubyid_volume'>volume</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_vd-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_vd</strong>(volume) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Delete a virtual disk. This also just hands the request off to the
appropriate controller.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>volume</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Volume.html" title="BarclampRaid::Volume (class)">BarclampRaid::Volume</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The volume to delete.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_vd'>delete_vd</span><span class='lparen'>(</span><span class='id identifier rubyid_volume'>volume</span><span class='rparen'>)</span>
  <span class='ivar'>@driver</span><span class='period'>.</span><span class='id identifier rubyid_delete_vd'>delete_vd</span><span class='lparen'>(</span><span class='id identifier rubyid_volume'>volume</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_candidates-instance_method">
  
    - (<tt>Array&lt;<span class='object_link'><a href="RaidDisk.html" title="BarclampRaid::RaidDisk (class)">BarclampRaid::RaidDisk</a></span>&gt;</tt>) <strong>find_candidates</strong>(volume) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a volume specification hash, find disks on the controller that are
good candidates for including in the to-be-created volume. This method
takes into account the desired size of the volume, whether or not this
volume can share disks with other volumes, the type of disks to use in the
volume, whether SAS or SATA volumes should be chosen, and it makes sure
that all chosen disks are of the same time and approximately the same size.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>volume</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash that contains the salient details of the volume. See
<span class='object_link'><a href="Driver.html#create_vd-instance_method" title="BarclampRaid::Driver#create_vd (method)">Driver#create_vd</a></span> for details on what keys are allowed and what they mean.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="RaidDisk.html" title="BarclampRaid::RaidDisk (class)">BarclampRaid::RaidDisk</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The disks that should be used to create the volume.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 234</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_candidates'>find_candidates</span><span class='lparen'>(</span><span class='id identifier rubyid_volume'>volume</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raid_level'>raid_level</span>  <span class='op'>=</span> <span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>raid_level</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_disks'>disks</span>       <span class='op'>=</span> <span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>disks</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_size'>size</span>        <span class='op'>=</span> <span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vol_size</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_exclusive'>exclusive</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exclusive</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exclusive</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_disk_type'>disk_type</span>   <span class='op'>=</span> <span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>disk_type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_protocol'>protocol</span>    <span class='op'>=</span> <span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>protocol</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_stripe_size'>stripe_size</span> <span class='op'>=</span> <span class='const'>BarclampRaid</span><span class='period'>.</span><span class='id identifier rubyid_size_to_bytes'>size_to_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_volume'>volume</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stripe_size</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>64 KB</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_disks'>disks</span><span class='comma'>,</span> <span class='id identifier rubyid_spans'>spans</span> <span class='op'>=</span> <span class='const'>BarclampRaid</span><span class='period'>.</span><span class='id identifier rubyid_calc_spans'>calc_spans</span><span class='lparen'>(</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='comma'>,</span><span class='id identifier rubyid_disks'>disks</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_min_disks'>min_disks</span><span class='comma'>,</span> <span class='id identifier rubyid_max_disks'>max_disks</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>BarclampRaid</span><span class='period'>.</span><span class='id identifier rubyid_calc_raid_overhead'>calc_raid_overhead</span><span class='lparen'>(</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='comma'>,</span><span class='id identifier rubyid_spans'>spans</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RAID type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='embexpr_end'>}</span><span class='tstring_content'> requires at least </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_min_disks'>min_disks</span><span class='embexpr_end'>}</span><span class='tstring_content'> disks</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_disks'>disks</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_min_disks'>min_disks</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RAID type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raid_level'>raid_level</span><span class='embexpr_end'>}</span><span class='tstring_content'> cannot have more than </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_disks'>max_disks</span><span class='embexpr_end'>}</span><span class='tstring_content'> disks</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_disks'>disks</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_max_disks'>max_disks</span>
  <span class='id identifier rubyid_candidate_sizes'>candidate_sizes</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_candidates'>candidates</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_exclusive'>exclusive</span>
    <span class='comment'># Only look at disks that do not have any RAID volumes on them.
</span>    <span class='id identifier rubyid_candidates'>candidates</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_unused_disks'>unused_disks</span>
    <span class='id identifier rubyid_candidates'>candidates</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span><span class='id identifier rubyid_candidate_sizes'>candidate_sizes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_disk_size'>disk_size</span><span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='comment'># Look at all the disks, and figure out how much free space each drive has.
</span>    <span class='id identifier rubyid_candidates'>candidates</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_diskscontroller'>diskscontroller</span> <span class='op'>=</span> <span class='const'>BarclampRaid</span><span class='op'>::</span><span class='const'>RaidHammer</span><span class='period'>.</span><span class='id identifier rubyid_drivers'>drivers</span><span class='lparen'>(</span><span class='const'>Node</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_controllers'>controllers</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_candidates'>candidates</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
      <span class='id identifier rubyid_candidate_sizes'>candidate_sizes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_disk_size'>disk_size</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_volumes'>volumes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_vol'>vol</span><span class='op'>|</span>
      <span class='id identifier rubyid_disk_size'>disk_size</span> <span class='op'>=</span> <span class='id identifier rubyid_vol'>vol</span><span class='period'>.</span><span class='id identifier rubyid_size_per_disks'>size_per_disks</span>
      <span class='id identifier rubyid_vol'>vol</span><span class='period'>.</span><span class='id identifier rubyid_disks'>disks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span>
        <span class='id identifier rubyid_candidate_sizes'>candidate_sizes</span><span class='lbracket'>[</span><span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>-=</span> <span class='id identifier rubyid_disk_size'>disk_size</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'># Bucketize candidates according to disk_type and protocol. Most RAID controllers
</span>  <span class='comment'># rewuire that the drives be fairly homogenous, so we enforce that all of the disks
</span>  <span class='comment'># in our prospective RAID volume talk the same protocol and are the same media type.
</span>  <span class='id identifier rubyid_type_buckets'>type_buckets</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_candidates'>candidates</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='id identifier rubyid_type_buckets'>type_buckets</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='comma'>,</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_media_type'>media_type</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_type_buckets'>type_buckets</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='comma'>,</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_media_type'>media_type</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_c'>c</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_chosen_buckets'>chosen_buckets</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_disk_type'>disk_type</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_disk_type'>disk_type</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>disk</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ssd</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c_mt'>c_mt</span><span class='op'>|</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_protocol'>protocol</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sas</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sata</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c_p'>c_p</span><span class='op'>|</span>
      <span class='id identifier rubyid_selector'>selector</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_c_p'>c_p</span><span class='comma'>,</span><span class='id identifier rubyid_c_mt'>c_mt</span><span class='rbracket'>]</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_type_buckets'>type_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_selector'>selector</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_type_buckets'>type_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_selector'>selector</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_disks'>disks</span>
        <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: Discarding disk type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_selector'>selector</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> due to insufficient disks</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_chosen_buckets'>chosen_buckets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_type_buckets'>type_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_selector'>selector</span><span class='rbracket'>]</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not enough combinable disks to satisfy volume creation request!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_chosen_buckets'>chosen_buckets</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='comment'># Bucketize the disks in each chosen bucket by size.  Base the sizes
</span>  <span class='comment'># on candidate_sizes, rounded down to the nearest 32 gigabytes.
</span>  <span class='comment'># This is hardly a perfect heuristic, but it should work well enough.
</span>  <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_chosen_buckets'>chosen_buckets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_bucket'>bucket</span><span class='op'>|</span>
    <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_size_buckets'>size_buckets</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_bucket'>bucket</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_disk'>disk</span><span class='op'>|</span>
      <span class='id identifier rubyid_size_bucket'>size_bucket</span> <span class='op'>=</span> <span class='id identifier rubyid_candidate_sizes'>candidate_sizes</span><span class='lbracket'>[</span><span class='id identifier rubyid_disk'>disk</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>35</span> <span class='op'>&lt;&lt;</span> <span class='int'>35</span>
      <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_size_bucket'>size_bucket</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_size_bucket'>size_bucket</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_disk'>disk</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_size_candidates'>size_candidates</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_size'>size</span>
                      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span>
                      <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>min</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
                      <span class='kw'>else</span>
                        <span class='id identifier rubyid_size_per_disk'>size_per_disk</span> <span class='op'>=</span> <span class='const'>BarclampRaid</span><span class='period'>.</span><span class='id identifier rubyid_raid_per_disk_size'>raid_per_disk_size</span><span class='lparen'>(</span>
                                                                        <span class='const'>BarclampRaid</span><span class='period'>.</span><span class='id identifier rubyid_size_to_bytes'>size_to_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span><span class='comma'>,</span>
                                                                        <span class='id identifier rubyid_raid_level'>raid_level</span><span class='comma'>,</span>
                                                                        <span class='id identifier rubyid_disks'>disks</span><span class='comma'>,</span>
                                                                        <span class='id identifier rubyid_spans'>spans</span><span class='comma'>,</span>
                                                                        <span class='id identifier rubyid_stripe_size'>stripe_size</span><span class='rparen'>)</span>
                        <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_size_per_disk'>size_per_disk</span> <span class='op'>&gt;&gt;</span> <span class='int'>35</span> <span class='op'>&lt;&lt;</span> <span class='int'>35</span><span class='rparen'>)</span><span class='rbrace'>}</span>
                      <span class='kw'>end</span>
    <span class='id identifier rubyid_size_candidates'>size_candidates</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_disks'>disks</span>
      <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_size_buckets'>size_buckets</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not enough compatible disks on controller </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> to build </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_volume'>volume</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='comment'># Now we have the candidates sorted in the order we should grab disks from.
</span>  <span class='comment'># Grab the disks we should use, sorted in ascending order by disk ID.
</span>  <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='period'>.</span><span class='id identifier rubyid_take'>take</span><span class='lparen'>(</span><span class='id identifier rubyid_disks'>disks</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    - (<tt>Object</tt>) <strong>inspect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Utility method to make backtraces and debugging easier by killing
irrelavent detail.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    - (<tt>Object</tt>) <strong>name</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Simple unique name.  Ideally, this will be unique across all raid
controllers.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@driver</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unused_disks-instance_method">
  
    - (<tt>Object</tt>) <strong>unused_disks</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get disks that are not members of a volume.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


219
220
221</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 219</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unused_disks'>unused_disks</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_disks'>disks</span> <span class='op'>-</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_used_disks'>used_disks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="used_disks-instance_method">
  
    - (<tt>Object</tt>) <strong>used_disks</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the disks that are members of a volume.  Note that this does not tell
you which volumes the disks are members of.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'crowbar_engine/barclamp_raid/app/models/barclamp_raid/driver.rb', line 212</span>

<span class='kw'>def</span> <span class='id identifier rubyid_used_disks'>used_disks</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_volumes'>volumes</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_memo'>memo</span><span class='comma'>,</span><span class='id identifier rubyid_obj'>obj</span><span class='op'>|</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_memo'>memo</span> <span class='op'>+</span> <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_disks'>disks</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Nov  4 04:15:57 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.2).
</div>

  </body>
</html>